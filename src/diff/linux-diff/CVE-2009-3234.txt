diff --git a/kernel/perf_counter.c b/kernel/perf_counter.c
index 
--- a/kernel/perf_counter.c
+++ b/kernel/perf_counter.c
@@-4171,6 +4171,7@@  static int perf_copy_attr(struct perf_co
 			if (val)
 				goto err_size;
 		}
+		size = sizeof(*attr);
 	}

 	ret = copy_from_user(attr, uattr, size);