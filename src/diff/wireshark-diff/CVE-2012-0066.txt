diff --git a/wiretap/5views.c b/wiretap/5views.c
index
--- trunk/wiretap/5views.c	2011/12/13 00:44:22	40164
+++ trunk/wiretap/5views.c	2011/12/13 00:57:09	40165
@@ -240,6 +240,16 @@
 
 	packet_size = TimeStamped_Header.RecSize;
 	orig_size = TimeStamped_Header.RecSize;
+	if (packet_size > WTAP_MAX_PACKET_SIZE) {
+		/*
+		 * Probably a corrupt capture file; don't blow up trying
+		 * to allocate space for an immensely-large packet.
+		 */
+		*err = WTAP_ERR_BAD_RECORD;
+		*err_info = g_strdup_printf("5views: File has %u-byte packet, bigger than maximum of %u",
+		    packet_size, WTAP_MAX_PACKET_SIZE);
+		return FALSE;
+	}
 
 	*data_offset = wth->data_offset;

diff --git a/wiretap/i4btrace.c b/wiretap/i4btrace.c
index
--- trunk/wiretap/i4btrace.c	2011/12/13 00:57:09	40165
+++ trunk/wiretap/i4btrace.c	2011/12/13 01:05:52	40166
@@ -145,6 +145,16 @@
 		return FALSE;
 	}
 	length = hdr.length - (guint32)sizeof(hdr);
+	if (length > WTAP_MAX_PACKET_SIZE) {
+		/*
+		 * Probably a corrupt capture file; don't blow up trying
+		 * to allocate space for an immensely-large packet.
+		 */
+		*err = WTAP_ERR_BAD_RECORD;
+		*err_info = g_strdup_printf("i4btrace: File has %u-byte packet, bigger than maximum of %u",
+		    length, WTAP_MAX_PACKET_SIZE);
+		return FALSE;
+	}
 
 	wth->phdr.len = length;
 	wth->phdr.caplen = length;