diff --git a/wiretap/pcap-common.c b/wiretap/pcap-common.c
index
--- trunk/wiretap/pcap-common.c	2012/02/12 23:50:13	41007
+++ trunk/wiretap/pcap-common.c	2012/02/13 03:03:03	41008
@@ -1602,6 +1602,18 @@
 			return -1;	/* Read error */
 
 		phdr_len += size;
+
+		if (check_packet_size &&
+		    packet_size < (guint)phdr_len) {
+			/*
+			 * Uh-oh, the packet isn't big enough for the pseudo-
+			 * header.
+			 */
+			*err = WTAP_ERR_BAD_FILE;
+			*err_info = g_strdup_printf("pcap: ERF file has a %u-byte packet, too small for a pseudo-header with ex- and sub-headers (%d)",
+			    packet_size, phdr_len);
+			return -1;
+		}
 		break;
 
 	case WTAP_ENCAP_I2C: