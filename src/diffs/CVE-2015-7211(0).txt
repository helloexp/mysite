# HG changeset patch
# User Gijs Kruitbosch <gijskruitbosch@gmail.com>
# Date 1446656084 0
#      Wed Nov 04 16:54:44 2015 +0000
# Node ID 47cb7ccfe478c59bad815ac8848283a6ec2d3cf2
# Parent  28e3554983f6af15685da76d7966b1a63e1d2fc0
Bug 1221444, r?bz

diff --git a/netwerk/protocol/data/nsDataHandler.cpp b/netwerk/protocol/data/nsDataHandler.cpp
--- a/netwerk/protocol/data/nsDataHandler.cpp
+++ b/netwerk/protocol/data/nsDataHandler.cpp
@@ -186,20 +186,26 @@ nsDataHandler::ParseURI(nsCString& spec,
             isBase64 = true;
             *base64 = '\0';
         }
     }
 
     if (comma == buffer) {
         // nothing but data
         contentType.AssignLiteral("text/plain");
         contentCharset.AssignLiteral("US-ASCII");
     } else {
+        // Replace hashes
+        char *hash = (char*) strchr(buffer, '#');
+        while (hash) {
+          *hash = '.';
+          hash = (char*) strchr(buffer, '#');
+        }
         // everything else is content type
         char *semiColon = (char *) strchr(buffer, ';');
         if (semiColon)
             *semiColon = '\0';
         
         if (semiColon == buffer || base64 == buffer) {
             // there is no content type, but there are other parameters
             contentType.AssignLiteral("text/plain");
         } else {
             contentType = buffer;
