# HG changeset patch
# User Christoph Kerschbaumer <mozilla@christophkerschbaumer.com>
# Date 1426119373 25200
#      Wed Mar 11 17:16:13 2015 -0700
# Node ID c1e06e90fd31e00df4fcb4b9bc3af8e7573a6936
# Parent  de155bb39613d16f66492c5ec2d2c74376df699a
Bug 1086999 - CSP: Asterisk (*) wildcard should not allow blob:, data:, or filesystem: when matching source expressions - web platform test update (r=sstamm,jgraham)

diff --git a/testing/web-platform/meta/content-security-policy/script-src/script-src-1_9.html.ini b/testing/web-platform/meta/content-security-policy/script-src/script-src-1_9.html.ini
--- a/testing/web-platform/meta/content-security-policy/script-src/script-src-1_9.html.ini
+++ b/testing/web-platform/meta/content-security-policy/script-src/script-src-1_9.html.ini
@@ -1,8 +1,5 @@
 [script-src-1_9.html]
   type: testharness
-  [test inline worker]
-    expected: FAIL
-
   [Violation report status OK.]
     expected: FAIL
 
diff --git a/testing/web-platform/tests/content-security-policy/script-src/buildInlineWorker.js b/testing/web-platform/tests/content-security-policy/script-src/buildInlineWorker.js
--- a/testing/web-platform/tests/content-security-policy/script-src/buildInlineWorker.js
+++ b/testing/web-platform/tests/content-security-policy/script-src/buildInlineWorker.js
@@ -1,21 +1,21 @@
 (function ()
 {
- var test = new async_test("test inline worker");
  var workerSource = document.getElementById('inlineWorker');
-
  var blob = new Blob([workerSource.textContent]);
 
  // can I create a new script tag like this? ack...
  var url = window.URL.createObjectURL(blob);
 
- var worker = new Worker(url);
+ try {
+   var worker = new Worker(url);
+ }
+ catch (e) {
+   done();
+ }
 
  worker.addEventListener('message', function(e) {
-    test.step(function () {
-        assert_not_equals(e.data, 'fail', 'inline script ran');
-        test.done();
-    })
+   assert_unreached("script ran");
  }, false);
 
  worker.postMessage('');
 })();
