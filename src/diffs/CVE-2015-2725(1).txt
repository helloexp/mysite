# HG changeset patch
# User Terrence Cole <terrence@mozilla.com>
# Date 1432147318 25200
#      Wed May 20 11:41:58 2015 -0700
# Node ID 2a00ab9109c18fb7ddca115d9271cef8ea6c8db3
# Parent  8551581fa2c67b1e57799d5e026806ca1e8a4e54
Bug 1159321 - Well-known symbols do not need pre-barriers. r=jonco

diff --git a/js/src/vm/Symbol.h b/js/src/vm/Symbol.h
--- a/js/src/vm/Symbol.h
+++ b/js/src/vm/Symbol.h
@@ -57,16 +57,21 @@ class Symbol : public js::gc::TenuredCel
 
     static inline js::ThingRootKind rootKind() { return js::THING_ROOT_SYMBOL; }
     inline void traceChildren(JSTracer* trc) {
         if (description_)
             js::TraceManuallyBarrieredEdge(trc, &description_, "description");
     }
     inline void finalize(js::FreeOp*) {}
 
+    static MOZ_ALWAYS_INLINE void writeBarrierPre(Symbol* thing) {
+        if (thing && !thing->isWellKnownSymbol())
+            thing->asTenured().writeBarrierPre(thing);
+    }
+
 #ifdef DEBUG
     void dump(FILE* fp = stderr);
 #endif
 };
 
 } /* namespace JS */
 
 namespace js {
